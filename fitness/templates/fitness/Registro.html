{% extends 'fitness/layout.html' %}
{% load static %}
{% block content %}

<div class="container">
    <h1>Registro</h1>
    
    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }}">{{ message }}</div>
        {% endfor %}
    {% endif %}

    <form method="POST" id="miFormulario">
        {% csrf_token %}
        
        <div class="row">
            <div class="col">
                <div class="mb-3">
                    <label for="rut" class="form-label">Rut</label>
                    <input type="text" class="form-control" id="rut" name="rut" required>
                </div>
            </div>
            <div class="col">
                <div class="mb-3">
                    <label for="nombre" class="form-label">Nombre</label>
                    <input type="text" class="form-control" id="nombre" name="nombre" required>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col">
                <div class="mb-3">
                    <label for="apellido_paterno" class="form-label">Apellido Paterno</label>
                    <input type="text" class="form-control" id="apellido_paterno" name="apellido_paterno" required>
                </div>
            </div>
            <div class="col">
                <div class="mb-3">
                    <label for="apellido_materno" class="form-label">Apellido Materno</label>
                    <input type="text" class="form-control" id="apellido_materno" name="apellido_materno" required>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col">
                <div class="mb-3">
                    <label for="fecha_nacimiento" class="form-label">Fecha De Nacimiento</label>
                    <input type="date" class="form-control" id="fecha_nacimiento" name="fecha_nacimiento" required>
                </div>
            </div>
            <div class="col">
                <div class="mb-3">
                    <label for="id_genero" class="form-label">Género</label>
                    <select class="form-select" id="id_genero" name="id_genero" required>
                        <option value="">Seleccione...</option>
                        {% for genero in generos %}
                            <option value="{{ genero.id_genero }}">{{ genero.genero }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col">
                <div class="mb-3">
                    <label for="telefono" class="form-label">Celular</label>
                    <input type="text" class="form-control" id="telefono" name="telefono" required>
                </div>
            </div>
            <div class="col">
                <div class="mb-3">
                    <label for="peso" class="form-label">Peso (kg)</label>
                    <input type="number" step="0.1" class="form-control" id="peso" name="peso" required>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col">
                <div class="mb-3">
                    <label for="email" class="form-label">Email</label>
                    <input type="email" class="form-control" id="email" name="email" required>
                </div>
            </div>
            <div class="col">
                <div class="mb-3">
                    <label for="direccion" class="form-label">Dirección</label>
                    <input type="text" class="form-control" id="direccion" name="direccion">
                </div>
            </div>
        </div>

        <!-- Sección de Perfil - Radio Buttons -->
        <div class="mb-3">
            <label class="form-label">Perfil</label>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="perfil" id="perfil_Entrenador" value="Entrenador" required>
                <label class="form-check-label" for="perfil_Entrenador">
                    Entrenador
                </label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="perfil" id="perfil_estudiante" value="estudiante" required>
                <label class="form-check-label" for="perfil_estudiante">
                    Estudiante
                </label>
            </div>
        </div>

        <div class="mb-3">
            <label for="username" class="form-label">Nombre de Usuario</label>
            <input type="text" class="form-control" id="username" name="username" required>
        </div>

        <div class="mb-3">
            <label for="password" class="form-label">Contraseña</label>
            <input type="password" class="form-control" id="password" name="password" required>
        </div>

        <button type="submit" class="btn btn-primary">Registrarse</button>
        <a href="{% url 'index' %}" class="btn btn-secondary">Volver</a>
    </form>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function() {
        $('#miFormulario').submit(function(event) {
            // Validaciones básicas
            var rut = $('#rut').val();
            var nombre = $('#nombre').val();
            var telefono = $('#telefono').val();
            var edad = new Date($('#fecha_nacimiento').val());
            var hoy = new Date();
            var edadCalculada = hoy.getFullYear() - edad.getFullYear();

            // Validar que se haya seleccionado un perfil
            var perfilSeleccionado = $('input[name="perfil"]:checked').val();
            if (!perfilSeleccionado) {
                alert('Por favor, selecciona un perfil.');
                event.preventDefault();
                return;
            }

            if (rut === '') {
                alert('Por favor, ingresa tu Rut.');
                event.preventDefault();
                return;
            }

            if (nombre.length < 3 || nombre.length > 20) {
                alert('Por favor, ingresa un Nombre válido entre 3 y 20 caracteres.');
                event.preventDefault();
                return;
            }

            if (telefono.length < 9) {
                alert('Por favor, ingresa un número de teléfono válido.');
                event.preventDefault();
                return;
            }

            if (edadCalculada < 18 || edadCalculada > 100) {
                alert('Debes tener entre 18 y 100 años para registrarte.');
                event.preventDefault();
                return;
            }
        });
    });
</script>

{% endblock %}